table_name: {{ env }}_gold.dim_employee
table_type: dimension
scd_type: 2
keys:
  surrogate_key: employee_sk
  natural_keys: [employee_id]

# Use Identity Columns (requires Databricks Runtime with Identity Column support)
surrogate_key_strategy: identity

track_history_columns:
  - department
  - title
  - manager_id

# Business-time SCD2: Use source timestamp for __valid_from/__valid_to instead of processing time
# If not set, defaults to processing time (__etl_processed_at)
effective_at: updated_at

default_rows:
  -1: "Unknown"

sources:
  - name: {{ env }}_silver.employees
    alias: e
    cdc_strategy: cdf
    primary_keys: [employee_id]  # Required for CDF deduplication

transformation_sql: |
  SELECT
    e.employee_id,
    e.first_name,
    e.last_name,
    e.department,
    e.title,
    e.manager_id,
    e.updated_at
  FROM e

audit_columns: true
