name: "kimball_dbt"
version: "1.0.0"
config-version: 2

profile: "databricks"

model-paths: ["models"]
analysis-paths: ["analyses"]
test-paths: ["tests"]
seed-paths: ["seeds"]
macro-paths: ["macros"]
snapshot-paths: ["snapshots"]

clean-targets:
  - "target"
  - "dbt_packages"

# Run-level hooks for ETL control table
on-run-start:
  - "{{ create_etl_control() }}"
  - "{{ batch_start_run() }}"

on-run-end:
  - "{{ batch_end_run() }}"

vars:
  # Catalog configuration (set dynamically by demo notebook)
  source_catalog: "main" # Will be overridden by --vars in demo

  # Schema configuration
  silver_schema: "demo_silver"
  gold_schema: "demo_gold"

  # ETL control table location
  etl_control_schema: "demo_gold"
  etl_control_table: "etl_control"

  # Kimball defaults for unknown dimensions
  unknown_sk: -1
  not_applicable_sk: -2
  error_sk: -3

# Model configurations
models:
  kimball_dbt:
    staging:
      +materialized: view
      +schema: staging
    dimensions:
      +materialized: table
      # Uses profile's schema directly (demo_gold)
    facts:
      +materialized: incremental
      # Uses profile's schema directly (demo_gold)
      +unique_key: order_item_id

snapshots:
  kimball_dbt:
    +target_schema: demo_gold
    +strategy: check
